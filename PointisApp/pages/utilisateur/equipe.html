<!-- chart Js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<!-- JQuery -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"
    integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>


<!--<script>
    // Ou est stocke Id sessionStorage de societé chez employé
    // let sessionId = sessionStorage.getItem("emp"),
    var pointage = document.getElementById('pointage-value'),
        selectPointage = document.getElementById('option-affichage'),
        selectPointage2 = document.querySelector('.option-affichage'),
        sessionId = sessionStorage.getItem('idSociete'),

        entree = 'https://face.activactions.net/api/Pointage/Day/' + sessionId,
        sorties = 'https://face.activactions.net/api/Pointage/Sortie/' + sessionId,
        absence = 'https://face.activactions.net/api/Pointage/AbsenceJour/' + sessionId,

        RetardDay = 'https://face.activactions.net/api/Pointage/Late/' + sessionId,
        retardWeek = 'https://face.activactions.net/api/Pointage/LateWeek/' + sessionId,
        retardMonth = 'https://face.activactions.net/api/Pointage/LateMounth/' + sessionId,

        utilisateurs = 'https://face.activactions.net/api/Connexion/Get/' + sessionId,
        employes = 'https://face.activactions.net/api/Employes/Get/' + sessionId,

        url20Jour = 'https://face.activactions.net/api/Pointage/DayTwenty/' + sessionId,
        pointageDay = "https://face.activactions.net/api/Pointage/DayTwenty/" + sessionId,
        pointageWeek = "https://face.activactions.net/api/Pointage/Week/" + sessionId,
        pointageMonth = "https://face.activactions.net/api/Pointage/Mounth/" + sessionId,

        sortiesDay = 'https://face.activactions.net/api/Pointage/Sortie/' + sessionId,
        sortiesWeek = 'https://face.activactions.net/api/Pointage/SortieSemaine/' + sessionId,
        sortiesMonth = 'https://face.activactions.net/api/Pointage/SortieMois/' + sessionId,

        entreeDay = 'https://face.activactions.net/api/Pointage/Entree/Day/' + sessionId,
        entreeWeek = 'https://face.activactions.net/api/Pointage/Entree/week/' + sessionId,
        entreeMonth = 'https://face.activactions.net/api/Pointage/Entree/Mounth/' + sessionId,


        absenceDay = 'https://face.activactions.net/api/Pointage/AbsenceJourSoc/' + sessionId,
        absenceWeek = 'https://face.activactions.net/api/Pointage/AbsenceSemaine/' + sessionId,
        absenceMonth = 'https://face.activactions.net/api/Pointage/AbsenceMois/' + sessionId;

    // Retard ?

    function formatComplet(arg) {
        let format = new Date(arg),
            ret;
        ret = format.toLocaleDateString('fr-fr', { weekday: "long", year: "numeric", month: "short", day: "numeric" });
        return ret
    }

    function formatHeure(arg) {
        if (arg === undefined) {
            let infos = "Pas encore pointé";
            return infos;
        }
        else {
            let format = new Date(arg),
                ret;
            ret = format.getHours() + "h:" + format.getMinutes() + "mn:" + format.getSeconds() + "s";
            return ret
        }
    }

    function convertion(minutes) {
        var hours = Math.floor(minutes / 60); // Nombre entier d'heures
        var remainingMinutes = minutes % 60; // Minutes restantes

        return hours + "h " + remainingMinutes + " mn";
    }

    function convert(minutes) {
        var hours = Math.floor(minutes / 60); // Nombre entier d'heures
        var remainingMinutes = minutes % 60; // Minutes restantes
        var seconds = remainingMinutes * 60; // Secondes

        return hours + "h " + remainingMinutes + " mn " + seconds + " s";
    }

</script>-->


<!--<div class="">
    <div class="row">
        <div class="col">
            <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="accordion-item">
                    <h2 class="accordion-header text-center" id="flush-headingOne">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                            Vu du Jour
                        </button>
                    </h2>
                    <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne"
                        data-bs-parent="#accordionFlushExample">
                        <ul class="accordion-body">
                            <li>Semaine</li>
                            <li>Mois</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>

    </div>-->

<div class="m-3">
    <div class="row m-3">
        <div class="col-9">
            <h2>Mon équipe</h2>
        </div>
        <form
            class="col-3 col-lg-auto mb-3 d-flex flex-row bg-dark justify-content-center align-items-center border rounded-5">
            <label for="search">
                <i class="fa fa-search" aria-hidden="true"></i>
            </label>
            <input type="search" class="form-control form-control-dark bg-dark text-light border-0"
                placeholder="Rechercher" aria-label="Search" id="search">
        </form>

    </div>
    <div class="row m-3">
        <div class="col">
            <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="accordion-item">
                    <h2 class="accordion-header text-center" id="flush-headingOne">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne"
                            id="vue">
                            Vue du Jour
                        </button>
                    </h2>
                    <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne"
                        data-bs-parent="#accordionFlushExample">
                        <ul class="accordion-body">
                            <li><a onclick="appelPagePointage('equipeJour','Vue du Jour')">Jour</a> </li>
                            <li><a onclick="appelPagePointage('equipeSemaine','Vue de la Semaine')">Semaine</a> </li>
                            <li><a onclick="appelPagePointage('equipeMois','Vue de du Mois')">Mois</a> </li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>

    </div>

</div>

<script>

    function formatComplet(arg) {
        let format = new Date(arg),
            ret;
        ret = format.toLocaleDateString('fr-fr', { weekday: "long", year: "numeric", month: "short", day: "numeric" });
        return ret
    }

    function formatHeure(arg) {
        if (arg === undefined) {
            let infos = "Pas encore pointé";
            return infos;
        }
        else {
            let format = new Date(arg),
                ret;
            ret = format.getHours() + "h:" + format.getMinutes() + "mn:" + format.getSeconds() + "s";
            return ret
        }
    }

    function appelPagePointage(lien, periode) {

        //alert("test");
        var lienComplet = 'pages/utilisateur/' + lien + '.html';
        $.ajax({

            url: lienComplet,
            method: 'GET',
            dataType: 'html',
            success: function (data) {
                $('#equipeshow').html(data);
            },
            error: function () {
                $('#equipeshow').html('Erreur lors du chargement des données.');
            }
        });
        $("#vue").html(periode);
        // });
    }

</script>
</script>

<div id="equipeshow">
    <div class="row m-3">
        <div class="col-6 d-flex flex-column">
            <div class="d-flex flex-row p-2 border border-1 border-dark rounded-3"
                style="background-color: whitesmoke;">
                <img src="images/import/clock.png" alt="" width="50px">
                <div class="d-flex flex-column">
                    <span id="retard">
                        <script>
                            fetch(retardEquipeJour)
                                .then(res => res.json())
                                .then(data => {
                                    var retardInner = data;

                                    if (retardInner > 0) {
                                        document.getElementById('retard').innerHTML = retardInner;
                                    } else {
                                        document.getElementById('retard').innerHTML = '00';
                                    }
                                });
                        </script>
                    </span>
                    <span>Retard</span>
                </div>
            </div><br /><br />

            <!--
            <div class="d-flex flex-row p-2 border border-1 border-dark rounded-3"
                style="background-color: whitesmoke;">
                <img src="images/import/absence.png" alt="" width="50px">
                <div class="d-flex flex-column">
                    <span id="absence">
                        <script>
                            var absenceInner = '';
                            var data = {}
                            fetch(absenceDay)
                                // fetch('https://face.activactions.net/api/Pointage/SortieSemaine') // Pour la semaine
                                .then(res => res.json())
                                .then(data => {
                                    for (let item of data) {
                                        absenceInner = item.Total;

                                        if (absenceInner > 0) {
                                            document.getElementById('absence').innerHTML = absenceInner;
                                        } else {
                                            document.getElementById('absence').innerHTML = '00';
                                        }
                                    }
                                });
                        </script>
                    </span>
                    <span>Absence</span>

                </div>
            </div><br /><br />
            -->

            <div class="d-flex flex-row p-2 border border-1 border-dark rounded-3"
                style="background-color: whitesmoke;">
                <img src="images/import/attendance.png" alt="" width="50px">
                <div class="d-flex flex-column">
                    <span>
                        <span id="presence">
                            <script>
                                fetch(entree)
                                    .then(res => res.json())
                                    .then(data => {
                                        var presence = data;
                                        var presenceInf = '0' + presence;

                                        if (presence > 0) {
                                            if (presence < 10) {
                                                document.getElementById('presence').innerHTML = presenceInf;
                                            }
                                            else {
                                                document.getElementById('presence').innerHTML = presence;
                                            }
                                        } else {
                                            document.getElementById('presence').innerHTML = '00';
                                        }
                                    });
                            </script>
                        </span>
                    </span>
                    <span>Pointage</span>
                </div>
            </div><br />

        </div>
        <div class="col-6">
            <canvas class="shadow-lg" id="myChartEquipe" style="width:100%;max-width:600px"></canvas>
        </div>

    </div>

    <div class="row m-3">
        <div class="col bg-light border border-1 border-dark rounded-3 m-0 p-0">
            <table class="table w-100">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">DATE</th>
                        <th scope="col">NOM</th>
                        <th scope="col">PRENOMS</th>
                        <th scope="col">TELEPHONE</th>
                        <th scope="col">ENTREES</th>
                        <th scope="col">SORTIES</th>
                    </tr>
                </thead>
                <tbody id="corpequipeall">
                    <script>

                        fetch(PointageEquipe)
                            .then(res => res.json())
                            .then(data => {
                                let infosEquipe = '';
                                console.log(data);
                                for (let item of data) {
                                    infosEquipe += `<tr><td>${formatComplet(item.PointageJour)}</td><td>${item.EmployeNom}</td><td>${item.EmployePrenom}</td><td>${item.EmployeTelephone}</td><td>${formatHeure(item.PointageHeureEntree)}</td><td>${formatHeure(item.PointageHeureSortie)}</td></tr>`;

                                }
                                document.getElementById('corpequipeall').innerHTML = infosEquipe;
                            });
                    </script>

                </tbody>

            </table>
        </div>

    </div>

</div>